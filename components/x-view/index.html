<polymer-element name="x-view">
    <template>
        <style>
            div {
                white-space: nowrap;
            }

            div a {
                display: inline-block;
                text-decoration: none;
                font-size: 14px;
                cursor: pointer;
                margin-left: 5px;
            }

            div a:hover {
                text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
            }
        </style>
        <div>
            <a class="iconfont" title="最小化" on-click="{{min}}">&#xe635;</a>
            <a class="iconfont" title="打开控制台" on-click="{{showDevTools}}">&#xe638;</a>
            <a class="iconfont" title="关闭" on-click="{{close}}">&#xe619;</a>
        </div>
    </template>
    <script>
        Polymer('x-view',{
            ready : function() {
                var self = this
                self.gui = require('nw.gui')
                self.win = self.gui.Window.get()
//                self.addTray()
//                FM.obs.on('SONG:UPDATE', self.addTray.bind(self))
                FM.obs.on('NOTI:CLICK', self.restore.bind(self))
//                self.showDevTools()
            },

            min : function() {
                this.win.minimize()
            },

            showDevTools : function() {
                this.win.isDevToolsOpen() ? this.win.closeDevTools() : this.win.showDevTools()
            },

            close : function() {
                if(this.tray) {
                    this.tray.remove()
                    this.tray = null
                }
                this.win.close()
            },

            restore : function() {
                this.win.restore()
            },

            addTray : function() {
                var self = this
                self.tray && self.tray.remove()
                var gui = self.gui
                var icon = self.getIcon()
                var tray = new gui.Tray({
                    title : '',
                    icon : icon.icon,
                    alticon: icon.alticon
                })

                var menu = new gui.Menu()
                menu.append(new gui.MenuItem({ label: 'Open' }));
                menu.append(new gui.MenuItem({ label: 'Quit' }));

                menu.items[0].click = self.restore.bind(self)
                menu.items[1].click = self.close.bind(self)


                tray.menu = menu
                tray.on('click',self.restore.bind(self))
                self.tray = tray
            },

            getIcon : function() {
                if(FM.status.song.like) {
                    return {
                        icon : './assets/images/red_tray.png',
                        alticon: './assets/images/red_tray@2x.png'
                    }
                } else {
                    return {
                        icon : './assets/images/blank_tray.png',
                        alticon: './assets/images/blank_tray@2x.png'
                    }
                }
            },
        })
    </script>
</polymer-element>